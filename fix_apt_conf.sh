#!/usr/bin/env bash
set -euo pipefail

FILE="/etc/apt/apt.conf.d/20auto-upgrades"
BACKUP="${FILE}.bak.$(date +%Y%m%d%H%M%S)"

#β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
# 1) root κ¶ν• ν™•μΈ
#β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
if [[ $EUID -ne 0 ]]; then
  echo ">> sudoλ΅ λ‹¤μ‹ μ‹¤ν–‰ν•©λ‹λ‹¤..."
  exec sudo "$0" "$@"
fi

echo "============================================"
echo "π‘  APT κµ¬λ¬Έ μ¤λ¥ λ³µκµ¬ μ¤ν¬λ¦½νΈ μ‹μ‘"
echo "    λ€μƒ νμΌ : $FILE"
echo "============================================"

#β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
# 2) κΈ°μ΅΄ νμΌ λ°±μ—…
#β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
if [[ -f "$FILE" ]]; then
  echo "π“¦  κΈ°μ΅΄ νμΌ λ°±μ—… β†’ $BACKUP"
  cp "$FILE" "$BACKUP"
fi

#β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
# 3) μ¬λ°”λ¥Έ λ‚΄μ©μΌλ΅ μ¬μ‘μ„±
#β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
cat > "$FILE" <<'EOF'
APT::Periodic::Update-Package-Lists "0";
APT::Periodic::Download-Upgradeable-Packages "0";
APT::Periodic::AutocleanInterval "0";
APT::Periodic::Unattended-Upgrade "0";
EOF

# (μ„ νƒ) Windows-CR μ κ±° κ°€λ¥μ„± λ€λΉ„
sed -i 's/\r$//' "$FILE"

echo "β…  μƒ μ„¤μ • μ™„λ£"

#β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
# 4) APT κµ¬λ¬Έ μ κ²€ & μ—…λ°μ΄νΈ μ‹ν—
#β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
echo -n "π”  κµ¬λ¬Έ μ κ²€ μ¤‘... "
if apt-config dump >/dev/null; then
  echo "OK"
else
  echo "μ‹¤ν¨! λ°±μ—… νμΌ($BACKUP)λ΅ λ³µμ› ν›„ μ§μ ‘ ν™•μΈν•μ„Έμ”."
  exit 1
fi

echo "π  sudo apt update μ‹¤ν–‰ν•μ—¬ μµμΆ… ν™•μΈν•©λ‹λ‹¤..."
apt update

echo "π‰  λ¨λ“  μ‘μ—…μ΄ μ™„λ£λμ—μµλ‹λ‹¤."

